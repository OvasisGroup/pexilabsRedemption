{% extends 'dashboard/base_dashboard.html' %}

{% block page_header %}Webhook Testing{% endblock %}

{% block content %}
<style>
    .test-section {
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 5px;
    }
    .form-group {
        margin: 15px 0;
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    input, textarea, select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }
    button {
        background: #3498db;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }
    button:hover {
        background: #2980b9;
    }
    .response {
        margin-top: 20px;
        padding: 15px;
        background: #e8f5e8;
        border: 1px solid #4caf50;
        border-radius: 4px;
        display: none;
    }
    .error {
        background: #ffebee;
        border-color: #f44336;
    }
    code {
        background: #e9ecef;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Monaco', 'Consolas', monospace;
    }
</style>

<a href="{% url 'documentation:api_documentation' %}" class="btn btn-secondary mb-3">‚Üê Back to API Documentation</a>
        
        <div class="test-section">
            <h2>Test Webhook Endpoint</h2>
            <p>Use this tool to test webhook payloads and verify your webhook endpoint integration.</p>
            
            <form id="webhookTestForm">
                <div class="form-group">
                    <label for="webhookUrl">Webhook URL:</label>
                    <input type="url" id="webhookUrl" name="webhookUrl" placeholder="https://yoursite.com/webhook" required>
                </div>
                
                <div class="form-group">
                    <label for="eventType">Event Type:</label>
                    <select id="eventType" name="eventType">
                        <option value="payment.completed">Payment Completed</option>
                        <option value="payment.failed">Payment Failed</option>
                        <option value="payment.refunded">Payment Refunded</option>
                        <option value="payment.disputed">Payment Disputed</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="payload">Test Payload (JSON):</label>
                    <textarea id="payload" name="payload" rows="10" placeholder='{
  "event": "payment.completed",
  "data": {
    "transaction_id": "txn_123456",
    "amount": 100.00,
    "currency": "USD",
    "status": "completed"
  }
}'></textarea>
                </div>
                
                <button type="submit">Send Test Webhook</button>
            </form>
            
            <div id="response" class="response">
                <h3>Response:</h3>
                <pre id="responseContent"></pre>
            </div>
        </div>
        
        <div class="test-section">
            <h2>PexiLabs Test Endpoint</h2>
            <p>You can also test sending webhooks to our test endpoint:</p>
            <p><code>{% url 'documentation:webhook_endpoint_test' %}</code></p>
            
            <button onclick="testPexiLabsEndpoint()">Test PexiLabs Endpoint</button>
        </div>
    </div>

<script>
    document.getElementById('webhookTestForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const url = document.getElementById('webhookUrl').value;
        const payload = document.getElementById('payload').value;
        
        // In a real implementation, this would send the webhook to the specified URL
        // For now, we'll just show a mock response
        showResponse({
            success: true,
            message: 'Webhook test would be sent to: ' + url,
            payload: JSON.parse(payload || '{}')
        });
    });
    
    function testPexiLabsEndpoint() {
        fetch('{% url "documentation:webhook_endpoint_test" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                event: 'test.webhook',
                data: {
                    test: true,
                    timestamp: new Date().toISOString()
                }
            })
        })
        .then(response => response.json())
        .then(data => showResponse(data))
        .catch(error => showResponse({success: false, error: error.message}, true));
    }
    
    function showResponse(data, isError = false) {
        const responseDiv = document.getElementById('response');
        const responseContent = document.getElementById('responseContent');
        
        responseContent.textContent = JSON.stringify(data, null, 2);
        responseDiv.className = 'response' + (isError ? ' error' : '');
        responseDiv.style.display = 'block';
    }
</script>
{% endblock %}