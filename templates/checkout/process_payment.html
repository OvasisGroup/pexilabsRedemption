<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Processing - PexiPay</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Payment Form Modal (Full Page) -->
    <div class="fixed inset-0 bg-gray-900 bg-opacity-75 overflow-y-auto h-full w-full z-50">
        <div class="relative h-full w-full bg-white">
            <div class="h-full flex flex-col">
                <!-- Modal Header -->
                <div class="flex items-center justify-between p-6 border-b bg-gray-50">
                    <h3 class="text-xl font-semibold text-gray-900">Payment Processing</h3>
                    {% if cancel_url %}
                    <a href="{{ cancel_url }}" class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </a>
                    {% endif %}
                </div>
                
                <!-- Modal Content -->
                <div class="flex-1 overflow-y-auto p-6">
                
                <!-- Test Mode Banner -->
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-4">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-500 mr-3"></i>
                        <div>
                            <h4 class="text-sm font-semibold text-yellow-800">Test Mode Active</h4>
                            <p class="text-sm text-yellow-700 mt-1">This is a test payment. No real charges will be made.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Form Container -->
                <div class="flex flex-col xl:flex-row gap-8 h-full">
                    <!-- Left Column - Form Fields -->
                    <div class="flex-1">
                        <form id="payment-form" class="space-y-6">
                            <!-- Payment Details -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="text-md font-medium text-gray-900 mb-4">Payment Details</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="payment-currency" class="block text-sm font-medium text-gray-700 mb-2">Currency</label>
                                        <input type="text" id="payment-currency" name="currency" value="{{ currency }}" readonly
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 focus:outline-none">
                                    </div>
                                    <div>
                                        <label for="payment-amount" class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                                        <input type="number" id="payment-amount" name="amount" value="{{ amount }}" readonly
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 focus:outline-none">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="payment-description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                    <input type="text" id="payment-description" name="description" value="{{ description }}" readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 focus:outline-none">
                                </div>
                            </div>
                            
                            <!-- Customer Information -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="text-md font-medium text-gray-900 mb-4">Customer Information</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="customer-first-name" class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                        <input type="text" id="customer-first-name" name="first_name" value="Test" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="customer-last-name" class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                        <input type="text" id="customer-last-name" name="last_name" value="User" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="customer-email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input type="email" id="customer-email" name="email" value="{{ customer_email }}" readonly
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 focus:outline-none">
                                    </div>
                                    <div>
                                        <label for="customer-phone" class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                                        <input type="tel" id="customer-phone" name="phone" value="+254700000000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Billing Address -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="text-md font-medium text-gray-900 mb-4">Billing Address</h4>
                                <div class="grid grid-cols-1 gap-4">
                                    <div>
                                        <label for="address-line1" class="block text-sm font-medium text-gray-700 mb-2">Address Line 1</label>
                                        <input type="text" id="address-line1" name="address_line1" value="Test Address Line 1" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="address-line2" class="block text-sm font-medium text-gray-700 mb-2">Address Line 2 (Optional)</label>
                                        <input type="text" id="address-line2" name="address_line2" value="" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label for="address-city" class="block text-sm font-medium text-gray-700 mb-2">City</label>
                                            <input type="text" id="address-city" name="address_city" value="Nairobi" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div>
                                            <label for="address-state" class="block text-sm font-medium text-gray-700 mb-2">State/Province</label>
                                            <input type="text" id="address-state" name="address_state" value="Nairobi" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label for="address-country" class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                                            <select id="address-country" name="address_country" 
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="KE" selected>Kenya</option>
                                                <option value="US">United States</option>
                                                <option value="GB">United Kingdom</option>
                                                <option value="CA">Canada</option>
                                                <option value="AU">Australia</option>
                                                <option value="DE">Germany</option>
                                                <option value="FR">France</option>
                                                <option value="NG">Nigeria</option>
                                                <option value="ZA">South Africa</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="address-postcode" class="block text-sm font-medium text-gray-700 mb-2">Postal Code</label>
                                            <input type="text" id="address-postcode" name="address_postcode" value="00100" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Create Payment Intent Button -->
                            <div class="flex justify-center">
                                <button type="button" onclick="createPaymentIntent()" 
                                        class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                                        id="create-intent-btn">
                                    <i class="fas fa-credit-card mr-2"></i>
                                    Create Payment Intent
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Right Column - Payment Widget -->
                    <div class="flex-1 min-h-0">
                        <div class="bg-gray-50 rounded-lg p-6 h-full flex flex-col">
                            <h4 class="text-lg font-medium text-gray-900 mb-6">Payment Widget</h4>
                            
                            <!-- Payment Widget Container -->
                            <div id="payment-widget-container" class="hidden flex-1">
                                <div class="bg-white rounded-lg border-2 border-dashed border-gray-300 p-6 text-center mb-4 h-full">
                                    <div id="paydock-payment-widget" class="min-h-[500px] flex items-center justify-center">
                                        <div class="text-gray-500">
                                            <i class="fas fa-spinner fa-spin text-3xl mb-3"></i>
                                            <p class="text-lg">Loading payment widget...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Placeholder -->
                            <div id="widget-placeholder" class="bg-white rounded-lg border-2 border-dashed border-gray-300 p-8 text-center flex-1 flex items-center justify-center">
                                <div class="text-gray-500">
                                    <i class="fas fa-credit-card text-4xl mb-4"></i>
                                    <p class="text-lg">Click "Create Payment Intent" to load the payment widget</p>
                                </div>
                            </div>
                            
                            <!-- Payment Status -->
                            <div id="payment-status" class="mt-4 hidden">
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                    <div class="flex items-center">
                                        <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                                        <span class="text-sm text-blue-700" id="payment-status-text">Ready for payment</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div> <!-- End Modal Content -->
            </div>
        </div>
    </div>

    <!-- Hidden form data -->
    <input type="hidden" id="session-id" value="{{ session_id }}">
    <input type="hidden" id="callback-url" value="{{ callback_url }}">
    <input type="hidden" id="cancel-url" value="{{ cancel_url }}">

    <script>
        function createPaymentIntent() {
            // Get form data
            const formData = {
                session_id: document.getElementById('session-id').value,
                currency: document.getElementById('payment-currency').value,
                amount: parseFloat(document.getElementById('payment-amount').value),
                customer: {
                    first_name: document.getElementById('customer-first-name').value,
                    last_name: document.getElementById('customer-last-name').value,
                    email: document.getElementById('customer-email').value,
                    phone: document.getElementById('customer-phone').value,
                    billing_address: {
                        address_line1: document.getElementById('address-line1').value,
                        address_line2: document.getElementById('address-line2').value,
                        address_city: document.getElementById('address-city').value,
                        address_state: document.getElementById('address-state').value,
                        address_country: document.getElementById('address-country').value,
                        address_postcode: document.getElementById('address-postcode').value
                    }
                },
                description: document.getElementById('payment-description').value,
                callback_url: document.getElementById('callback-url').value,
                cancel_url: document.getElementById('cancel-url').value
            };

            // Show loading state
            const button = document.getElementById('create-intent-btn');
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';

            // Hide placeholder and show widget container
            document.getElementById('widget-placeholder').classList.add('hidden');
            document.getElementById('payment-widget-container').classList.remove('hidden');
            document.getElementById('payment-status').classList.remove('hidden');

            // Simulate payment processing (replace with actual integration)
            setTimeout(() => {
                document.getElementById('paydock-payment-widget').innerHTML = `
                    <div class="text-center">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                            <i class="fas fa-check-circle text-green-500 text-4xl mb-4"></i>
                            <h3 class="text-lg font-semibold text-green-800 mb-2">Payment Intent Created</h3>
                            <p class="text-sm text-green-700">Session ID: ${formData.session_id}</p>
                            <p class="text-sm text-green-700">Amount: ${formData.currency} ${formData.amount}</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('payment-status-text').textContent = 'Payment intent created successfully';
                
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-check mr-2"></i>Payment Intent Created';
                button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                button.classList.add('bg-green-600', 'hover:bg-green-700');
            }, 2000);
        }
    </script>
</body>
</html>